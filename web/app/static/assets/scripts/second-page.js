var backgroundColor="#404a59",areaColor="#323c48",borderColor="#111",emphasisAreaColor="#2a333d",foregroundColor="#fff",shadowColor="#333";!function(){d3.hexbin=function(){function o(e){var t={};return e.forEach(function(e,r){var a=p.call(o,e,r)/s,n=Math.round(a),l=h.call(o,e,r)/i-(1&n?.5:0),d=Math.round(l),c=a-n;if(3*Math.abs(c)>1){var u=l-d,m=d+(d>l?-1:1)/2,g=n+(n>a?-1:1),f=l-m,w=a-g;u*u+c*c>f*f+w*w&&(d=m+(1&n?1:-1)/2,n=g)}var y=d+"-"+n,v=t[y];v?v.push(e):(v=t[y]=[e],v.i=d,v.j=n,v.x=(d+(1&n?.5:0))*i,v.y=n*s)}),d3.values(t)}function a(t){var r=0,o=0;return e.map(function(e){var a=Math.sin(e)*t,n=-Math.cos(e)*t,i=a-r,s=n-o;return r=a,o=n,[i,s]})}var n,i,s,l=1,d=1,h=t,p=r;return o.x=function(e){return arguments.length?(h=e,o):h},o.y=function(e){return arguments.length?(p=e,o):p},o.hexagon=function(e){return arguments.length<1&&(e=n),"m"+a(e).join("l")+"z"},o.centers=function(){for(var e=[],t=0,r=!1,o=0;d+n>t;t+=s,r=!r,++o)for(var a=r?i/2:0,h=0;l+i/2>a;a+=i,++h){var p=[a,t];p.i=h,p.j=o,e.push(p)}return e},o.mesh=function(){var e=a(n).slice(0,4).join("l");return o.centers().map(function(t){return"M"+t+"m"+e}).join("")},o.size=function(e){return arguments.length?(l=+e[0],d=+e[1],o):[l,d]},o.radius=function(e){return arguments.length?(n=+e,i=2*n*Math.sin(Math.PI/3),s=1.5*n,o):n},o.radius(1)};var e=d3.range(0,2*Math.PI,Math.PI/3),t=function(e){return e[0]},r=function(e){return e[1]}}();for(var margin={top:50,left:50,bottom:0,right:0},width=$("#grid").width()-margin.left-margin.right,height=$(window).height()/2-margin.top-margin.bottom,MapColumns=6,MapRows=5,hexbinWidth=width/((MapColumns+.5)*Math.sqrt(3)),hexbinHeight=2*height/(1.5*(MapRows+1/3)),hexRadius=d3.min([hexbinWidth,hexbinHeight]),selectedGrid=[],row=0;MapRows>row;row+=1){selectedGrid.push([]);for(var col=0;MapColumns>col;col+=1)selectedGrid[row].push(!1)}for(var toBeSelected=15;toBeSelected>0;){var row=parseInt(Math.random()*MapRows,10)%MapRows,col=parseInt(Math.random()*MapColumns,10)%MapColumns;selectedGrid[row][col]||(selectedGrid[row][col]=toBeSelected,toBeSelected-=1)}for(var points=[],i=0;MapRows>i;i++)for(var j=0;MapColumns>j;j++)selectedGrid[i][j]&&points.push([hexRadius*j*1.75,hexRadius*i*1.5]);var svg=d3.select($("#grid").get(0)).append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")"),hexbin=d3.hexbin().radius(hexRadius),node=svg.append("g").selectAll(".hexagon").data(hexbin(points)).enter().append("g").style("cursor","pointer");node.append("path").attr("class","hexagon").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).attr("d",hexbin.hexagon()).style("fill",areaColor).attr("stroke",borderColor).attr("stroke-width","1px").style("transition","all 0.2s ease-in");var wrap=function(){this.each(function(){var e=d3.select(this),t=e.text().split("\n");if(t.length>1){e.text("");for(var r=(t.length-1)/2,o=0;o<t.length;o+=1)t[o]&&e.append("tspan").attr("x",e.attr("dx")).attr("y",e.attr("dy")).attr("dx",0).attr("dy",1.2*(o-r)+"em").text(t[o])}})},wordColors={"工作词":"DeepSkyBlue","休闲词":"LIGHTCYAN","金钱词":"Yellow","宗教词":"lightyellow","死亡词":"MOCCASIN","正向情绪词":"Cyan","负向情绪词":"Violet","焦虑词":"MediumSpringGreen","生气词":"OrangeRed","悲伤词":"Aquamarine","家庭词":"Salmon","希望度":"Chartreuse","问题解决度":"Darkorange","悲观度":"HotPink","犬儒度":"TURQUOISE"},displayedWords=["工作词","休闲词","金钱词","宗教词","死亡词","正向\n情绪词","负向\n情绪词","焦虑词","生气词","悲伤词","家庭词","希望度","问题\n解决度","悲观度","犬儒度"],fontSize=hexRadius/2;node.append("text").style("font-size",function(){return fontSize.toString()+"px"}).attr("dx",function(e){return e.x}).attr("dy",function(e){return e.y+5}).style("text-anchor","middle").style("transition","all 0.2s ease-in").text(function(e){var t=selectedGrid[e.j][e.i]-1;return displayedWords[t]}).call(wrap).style("fill",function(e){var t=selectedGrid[e.j][e.i]-1,r=Object.keys(wordColors)[t];return wordColors[r]});var itemHighlight=function(e){this.parentNode.insertBefore(this,lastClickedItem);var t=selectedGrid[e.j][e.i]-1,r=Object.keys(wordColors)[t];d3.select(this).select("path").style("stroke",wordColors[r]).style("stroke-width","3px")},itemResume=function(e){d3.select(this).select("path").style("stroke",borderColor).style("stroke-width","1px")},lastClickedItem=null;node.on("mouseover",itemHighlight).on("mouseleave",itemResume).on("click",function(e){this.parentNode.appendChild(this),d3.select(this).on("mouseover",null).on("mouseleave",null),d3.select(this).select("path").style("stroke-width","5px"),d3.select(lastClickedItem).on("mouseover",itemHighlight).on("mouseleave",itemResume),lastClickedItem&&itemResume.apply(lastClickedItem,d3.select(lastClickedItem)),lastClickedItem=lastClickedItem==this?null:this;var t=selectedGrid[e.j][e.i]-1;updateMap(displayedWords[t].split("\n").join(""))});var histogramArea=document.getElementById("histogram");$(histogramArea).css("height",$(window).height()/2);var myHistogram=echarts.init(histogramArea);myHistogram.showLoading();var wordSeries=["正向情绪词","负向情绪词","焦虑词","生气词","悲伤词"],topics=["娱乐体育","文化科学","时事政治","财经新闻","社会民生","国际新闻","公共安全热点"],seriesGenerator=function(e){for(var t=[],r=0;r<wordSeries.length;r+=1){var o=wordSeries[r];t.push({name:wordSeries[r],type:"bar",data:e[o],itemStyle:{normal:{color:wordColors[o]}}})}return t},getHistogramOption=function(){var e={tooltip:{trigger:"item",formatter:function(e,t,r){var o=histogramData.topCities[e.seriesName][e.name];return e.seriesName+"<br/>"+e.value+"<br/>Top1: "+o[0]+"<br/>Top2: "+o[1]+"<br/>Top3: "+o[2]}},legend:{orient:"horizontal",x:"center",y:"top",data:wordSeries,textStyle:{color:"#fff"}},grid:{right:"10%",bottom:"10%",containLabel:!0},xAxis:[{type:"category",data:topics,axisLabel:{textStyle:{color:"#fff"},formatter:function(e,t){for(var r="",o=0;o<e.length;o+=1)r+=e[o]+(o&&o%2?"\n":"");return r}}}],yAxis:[{type:"value",axisLabel:{textStyle:{color:"#fff"}}}],series:seriesGenerator(histogramData.wordFrequencies)};return e},histogramData="";$.getJSON("/static/assets/data/histogramData.json",function(e){histogramData=e,myHistogram.hideLoading(),myHistogram.setOption(getHistogramOption())});var mapArea=document.getElementById("map");$(mapArea).css("height",$(window).height());var myMap=echarts.init(mapArea);myMap.showLoading();var getMapOption=function(e,t){var r={backgroundColor:backgroundColor,title:{text:"思维与心态"+(e?" - "+e:""),sublink:"",left:"center",top:"12%",textStyle:{color:wordColors[e],fontSize:2*fontSize}},tooltip:{trigger:"item",formatter:function(e,t,r){return"Top "+e.value[2]+"<br/>"+e.name},extraCssText:"text-align:center"},geo:{map:"china",label:{normal:{show:!1},emphasis:{show:!1}},itemStyle:{normal:{areaColor:areaColor,borderColor:borderColor},emphasis:{areaColor:areaColor}}},series:[{name:"Top 10",type:"effectScatter",coordinateSystem:"geo",data:t,symbolSize:function(e){return 25-2*e[2]},showEffectOn:"render",effectType:"ripple",rippleEffect:{brushType:"stroke"},symbol:"circle",hoverAnimation:!0,label:{normal:{formatter:"{b}",position:"top",show:!0,textStyle:{fontWeight:"bolder"}}},itemStyle:{normal:{color:wordColors[e],shadowBlur:10,shadowColor:shadowColor}},zlevel:1}]};return r},wordMap=null,updateMap=function(e){e=e?e:"正向情绪词",wordMap?myMap.setOption(getMapOption(e,wordMap[e])):$.getJSON("/static/assets/data/wordMap.json",function(t){wordMap=t,myMap.hideLoading(),myMap.setOption(getMapOption(e,wordMap[e]))})};updateMap();
